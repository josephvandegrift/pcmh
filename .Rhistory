library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
usethis::use_package("openxlsx")
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
?read_pdf_data
usethis::use_package("scales")
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
out <- janitor::clean_names(out)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
?generate_care_category_page
?.extract_care_categry
library(pcmh)
library(pcmh)
library(pcmh)
library(pcmh)
here::here
here::here()
"H:/qhp"
"H:/pcmh"
library(pcmh)
"H:/pcmh" %>% fs::dir_ls()
fs::dir_ls("H:/pcmh")
import_pdf_data("H:/pcmh")
fs::dir_ls("U:\AR_reports\PCMH\2021\Q22021_PCMH_2021_06142021_FINAL")
fs::dir_ls("U:/AR_reports/PCMH/2021\Q22021_PCMH_2021_06142021_FINAL")
fs::dir_ls("U:/AR_reports/PCMH/2021/Q22021_PCMH_2021_06142021_FINAL")
fs::dir_ls("U:/AR_reports/PCMH/2021/Q22021_PCMH_2021_06142021_FINAL")[[1]]
fs::dir_ls("U:/AR_reports/PCMH/2021/Q22021_PCMH_2021_06142021_FINAL")[[1:2]]
fs::dir_ls("U:/AR_reports/PCMH/2021/Q22021_PCMH_2021_06142021_FINAL")[1:2]
import_pdf_data("U:/AR_reports/PCMH/2021/Q22021_PCMH_2021_06142021_FINAL", regexp = ".pdf")
tictoc::tic
import_pdf_data("U:/AR_reports/PCMH/2021/Q22021_PCMH_2021_06142021_FINAL", regexp = ".pdf")
tictoc::toc
tictoc::tic()
import_pdf_data("U:/AR_reports/PCMH/2021/Q22021_PCMH_2021_06142021_FINAL", regexp = ".pdf")
tictoc::toc()
tictoc::tic()
import_metric_data("U:/AHCPII\Episodes of Care/Qrtly Reports/SAS team QA/Individual folders/Joseph/projects/pcmh_qa/data", regexp = "6912_prvdr")
tictoc::toc()
tictoc::tic()
import_metric_data("U:/AHCPII/Episodes of Care/Qrtly Reports/SAS team QA/Individual folders/Joseph/projects/pcmh_qa/data", regexp = "6912_prvdr")
tictoc::toc()
tictoc::tic()
import_metric_data("U:/AHCPII/Episodes of Care/Qrtly Reports/SAS team QA/Individual folders/Joseph/projects/pcmh_qa/data", regexp = "7012_prvdr_metrics.xlsx")
tictoc::toc()
metric_data <- import_metric_data("U:/AHCPII/Episodes of Care/Qrtly Reports/SAS team QA/Individual folders/Joseph/projects/pcmh_qa/data", regexp = "7012_prvdr_metrics.xlsx")
tictoc::tic()
pdf_data <- import_pdf_data("U:/AR_reports/PCMH/2021/Q22021_PCMH_2021_06142021_FINAL", regexp = ".pdf")
tictoc::toc()
library(pcmh)
library(pcmh)
data_path <-
"U:/AHCPII/Episodes of Care/Qrtly Reports/SAS team QA/Individual folders/Joseph/projects/pcmh_qa/data"
future::plan(future::multisession)
tictoc::tic()
reports_21q3 <-
pcmh::import_pdf_data("U:/AR_reports/PCMH/Q32021_PCMH_2021_09072021",
regexp = ".pdf")
tictoc::toc()
read_metric_data <- function(.dir, ...) {
file_path <- fs::dir_ls(.dir, ...)
out <-
ifelse(length(file_path) > 1,
return("More than 1 File"),
return(vroom::vroom(file_path)))
}
clean_metric_data <- function(.df) {
clean1 <-
.df %>%
select(ends_with(c(
"flag",
"pctl_group",
"text",
"id",
"impl",
"reporttype",
"pcmh_name",
"report_layout",
"reporttype",
"_name"
))) %>%
mutate(
across(
ends_with("text"),
~ case_when(. == "Pass" ~ "G",
. == "Fail" ~ "R",
TRUE ~ "A")
),
across(
ends_with("pctl_group"),
~ case_when(. == "36+" ~ "R",
. == "1-10" ~ "G",
. == "11-35" ~ "Y",
TRUE ~ "A")
),
across(ends_with("flag"),
~ case_when(. == "1" ~ "G",
TRUE ~ "A"))
)
clean2 <-
.df %>%
select(-ends_with(c(
"flag",
"pctl_group",
"text",
"id",
"impl",
"reporttype",
"pcmh_name",
"report_layout",
"reporttype",
"_name"
))) %>%
mutate(
across(where(is.character), parse_number)
)
out <-
cbind(clean1, clean2)
out <-
janitor::clean_names(out)
return(as_tibble(out))
}
data_21q3 <-
data_path %>%
read_metric_data(regexp = "report_pcmh_2021q3_21") %>%
clean_metric_data()
data_21q3 <-
data_path |>
read_metric_data(regexp = "report_pcmh_2021q3_21") |>
clean_metric_data()
library(tidyverse)
data_21q3 <-
data_path %>%
read_metric_data(regexp = "report_pcmh_2021q3_21") %>%
clean_metric_data()
params_21q3 <-
file.path(data_path,
"pcmh-crosswalk_21q2.csv") %>%
vroom::vroom()
tictoc::tic()
detail_21q3 <-
map_dfr(reports_21q3,
~ {
report <- .x
map_dfr(1:nrow(params_21q3),
~ generate_detail(report,
data_21q3,
params_21q3[., ]))
})
tictoc::toc()
View(detail_21q3)
detail_21q3 %>% filter(mismatch_type != "Match") %>% group_by(variable) %>% summarise(n = n()) %>% arrange(desc(n))
detail_21q3 %>% filter(mismatch_type == "Mismatch") %>% group_by(variable) %>% summarise(n = n()) %>% arrange(desc(n))
library(pcmh)
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique(),
~ summary_function(detail_21q3, .))
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique(),
~ generate_summary(detail_21q3, .))
View(summary_21q3)
View(detail_21q3)
detail_21q3$prvdr_num |>
+                 unique()
detail_21q3$prvdr_num |> unique()
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique(),
~ generate_summary(detail_21q3[which(detail_21q3$`Mismatch Type` == "Mismatch"), ], .))
View(summary_21q3)
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique(),
~ generate_summary(detail_21q3[which(detail_21q3$mismatch_type == "Mismatch"), ], .))
detail_21q3[which(detail_21q3$mismatch_type == "Mismatch"), ]
library(pcmh)
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique(),
~ generate_summary(detail_21q3, .))
#' @param .detail A \code{dataframe} generated by \code{\link[pcmh]{generate_detail}}.
#' @param .prvdr_num A 9 digit \code{intiger}.
#'
#' @return Returns an nx2 \code{dataframe} for n \code{.prvdr_num}.
#' @export
#'
#' @examples
#' \dontrun{
#' generate_summary(.detail, .prvdr_num)
#' }
generate_summary <- function(.detail, .prvdr_num) {
# Subset detail based on .prvdr_num
detail <-
.detail[which(.detail$prvdr_num == .prvdr_num), ]
# Initialize output
out <-
detail[1, "prvdr_num"]
# Summarize Mismatch Type for each Provider
if("Missing" %in% .detail[which(.detail$prvdr_num == .prvdr_num),
"mismatch_type"] &
"Mismatch" %in% .detail[which(.detail$prvdr_num == .prvdr_num),
"mismatch_type"]) {
out["type"] <-
"Missing/Mismatch"
} else if ("Missing" %in% .detail[which(.detail$prvdr_num == .prvdr_num),
"mismatch_type"]) {
out["type"] <-
"Missing"
} else if ("Mismatch" %in% .detail[which(.detail$prvdr_num == .prvdr_num),
"mismatch_type"]) {
out["type"] <-
"Mismatch"
} else {
out["type"] <-
.detail["mismatch_type"]
# "Something unexpected"
}
# Give columns human readable names
names(out) <-
c("Provider Number",
"Mismatch Type")
# Return output
return(out)
}
library(pcmh)
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique(),
~ generate_summary(detail_21q3, .))
detail_21q3$prvdr_num |> unique()
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique() |>,
~ generate_summary(detail_21q3, .))
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique() |>
as.numeric(),
~ generate_summary(detail_21q3, .))
rem(generate_summary())
rm(generate_summary())
rm(generate_summary)
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique() |>,
~ generate_summary(detail_21q3, .))
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique(),
~ generate_summary(detail_21q3, .))
library(pcmh)
summary_21q3 <-
map_dfr(detail_21q3$prvdr_num |>
unique(),
~ generate_summary(detail_21q3, .))
View(summary_21q3)
params_21q3[which[!is.na(params_21q3$variable)]
a
params_21q3[which[!is.na(params_21q3$variable)]]
params_21q3[which(!is.na(params_21q3$variable))]
which(!is.na(params_21q3$variable))
params_21q3[, which(!is.na(params_21q3$variable))]
params_21q3[which(!is.na(params_21q3$variable)), ]
params_21q3[which(!is.na(params_21q3$variable)) &
which(!is.na(params_21q3$x)) &, ]
params_21q3[which(!is.na(params_21q3$variable)) &
which(!is.na(params_21q3$x)) &
which(!is.na(params_21q3$y)), ]
params_21q3[which(!is.na(params_21q3$variable) & !is.na(params_21q3$x) & !is.na(params_21q3$y)), ]
View(detail_21q3)
detail_21q3 %>% group_by(prvdr_num, mismatch_type) %>% sumamrise(n = n()) %>% arrange(desc(n))
detail_21q3 %>% group_by(prvdr_num, mismatch_type) %>% summarise(n = n()) %>% arrange(desc(n))
library(pcmh)
tictoc::tic()
detail_21q3 <-
map_dfr(reports_21q3,
~ {
report <- .x
map_dfr(1:nrow(params_21q3),
~ generate_detail(report,
data_21q3,
params_21q3[., ]))
})
tictoc::toc()
params_21q3[which(!is.na(params_21q3$variable) &
!is.na(params_21q3$x) &
!is.na(params_21q3$y)), ]
library(pcmh)
